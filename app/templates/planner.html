{% extends "layout.html" %}

{% block styles %}
<style>
	.collection-course-item:hover, .tag-course-item:hover, #collectionsContainer .btn:hover {
		background-color: var(--bs-gray-200) !important;
	}
	
	.collection-course-item .edit, .overall-collection-item .disable {
		display: none;
	}
	
	.collection-course-item:hover .edit, .overall-collection-item:hover .disable {
		display: block;
	}

	#transfer-collapsed .d-flex span {
		writing-mode: vertical-lr;
		text-orientation: sideways;
		transform: rotate(180deg);
	}
</style>
{% endblock %}

{% block headscripts %}
<script>
	var grades = JSON.parse('{{ grades | tojson | safe }}')
	var showTransferred = JSON.parse('{{ transferred | tojson | safe }}')
</script>
{% endblock %}

{% block content %}

<!--TEMPLATES-->
<div id="templates" class="d-none">
	<div class="collection-item col-10 col-sm-7 col-md-5 col-lg-4 col-xl-3 px-2" db-id="" db-units="" db-points="" db-gpa="" db-term="">
		<div class="card h-100">
			<!--Remove collection button-->
			<button class="collection-remove position-absolute top-0 start-100 translate-middle badge rounded-pill btn btn-light border-secondary" title="" onclick="">
				<i class="bi-x-lg text-secondary"></i>
			</button>
			<!--Term info header-->
			<div class="card-header text-center">
				<span class="h5" title="Term season and year">
					<span class="term-name"></span>
					<i class="term-current d-none fs-6 bi-circle-fill text-success" data-bs-toggle="tooltip" data-bs-placement="right" title="Current"></i>
				</span>
				<div class="term-date invisible m-0 text-muted fst-italic lh-1" style="height: 1rem;">
					<small class="start" title="Start date"></small>
					<i class="bi-arrow-right-short"></i>
					<small class="end" title="End date"></small>
				</div>
			</div>
			<div class="loading text-center mt-4 mb-2" title="Loading courses...">
				<div class="spinner-border" role="status">
					<span class="visually-hidden">Loading...</span>
				</div>
			</div>
			<div class="collection-course-container card-body p-1" db-id=""></div>
			<div class="loaded pb-2 text-center">
				<a class="add-course text-body" href="" data-bs-toggle="modal" data-bs-target="#modalAddCourse" db-id="">
					Add course
				</a>
			</div>
			<div class="card-footer">
				<div class="row">
					<span class="col-3">
						<div class="form-check form-switch" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Show in overall GPA">
							<input class="countInGPA form-check-input" type="checkbox" role="switch">
						</div>
					</span>
					<span class="col-6 text-center">Term GPA:</span>
					<span class="col-3 font-monospace text-start collection-gpa pe-0">
						<span class="gpa" data-bs-toggle="tooltip" data-bs-placement="bottom" title=""></span>
						<span class="nogpa pe-2" style="cursor: default;" data-bs-toggle="tooltip" data-bs-placement="bottom" title="One or more courses don't have a grade or they don't count towards the GPA">
							-
						</span>
					</span>
				</div>
			</div>
		</div>
	</div>
	<div class="collection-course-item m-1 btn bg-light card" db-id="" db-term="" db-passed="" db-grade="" db-code="" db-name="" db-url="" db-units="" db-repeat="" db-countgpa="" draggable="true"
	data-bs-toggle="modal" data-bs-target="#modalInfoUserCourse" title="Click to view or drag to change term">
		<div class="row">
			<span class="emoji col-3 h5 p-0 m-0"></span>
			<span class="code col-6 font-monospace"></span>
			<span class="grade col-3 font-monospace text-start" title=""></span>
		</div>
		<div class="edit position-absolute end-0 pe-2">
			<i class="bi-pencil-fill"></i>
		</div>
	</div>
</div>

<!--Courses per term-->
<div class="container-fluid mb-5">
	<div class="d-flex justify-content-between">
		<h2 class="m-0">Courses per term</h2>

		<div class="loading spinner-border" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>

		<button type="button" class="loaded btn btn-secondary m-0 py-0" data-bs-toggle="modal" data-bs-target="#modalAddCollection">
			<i class="bi-calendar-plus-fill"></i>
			Add term
		</button>
	</div>

	<div id="collectionsContainer" class="loaded row flex-nowrap overflow-scroll pt-3">
		<div id="transfer-collapsed" class="col-2 col-md-1 card mx-2 p-0 d-none">
			<div class="card-body btn btn-light" onclick="transferredShow()" title="Show transferred courses">
				<div class="h-100 d-flex justify-content-center text-center">
					<span class="h4 lh-1">
						<span class="align-top">Transferred</span>
						<i class="bi-caret-down-fill fs-4"></i>
					</span>
				</div>
			</div>
		</div>
	</div>
</div>

<!--Overall GPA-->
<div class="container">
	<div id="overallGPA" class="row ms-0">
		<div class="col-12 col-lg-5 col-xl-6 col-xxl-3 h2 ps-0">
			<span class="">Overall GPA:</span>
			<span class="final-gpa ms-4 font-monospace">3.2</span>
		</div>
		<div class="col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5 px-1 card ms-xxl-4">
			<div class="card-body px-2">
				<div id="overallCollectionContainer"></div>
				<div class="row">
					<span class="col-8 col-sm-9 ps-2 ps-lg-3 pe-4"><hr class="my-2"></span>
				</div>
				<div class="row">
					<span class="col-6 col-sm-7 text-end ps-2"></span>
					<span class="col-6 col-sm-5 px-0 font-monospace">
						<span class="sum-points" title="Sum of points">-</span>
						/
						<span class="sum-units" title="Sum of units">-</span>
						=
						<span class="final-gpa fw-bold" title="Overall GPA">-</span>
					</span>
				</div>
			</div>
		</div>
	</div>
</div>

<!--Info modals-->
<div class="modal fade" id="modalInfoUserCourse" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Course info</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body px-4">
				<!--Term-->
				<div class="row">
					<div class="col-3">
						<span class="h5">Term</span>
					</div>
					<div class="col">
						<span class="term fs-5"></span>
					</div>
				</div>
				<hr>
				<!--Course-->
				<div class="row">
					<div class="col-3">
						<span class="h5">Course</span>
					</div>
					<div class="col">
						<div class="fs-5">
							<span class="emoji" title="Course emoji"></span>
							<a class="link text-decoration-none text-body" href="" target="_blank" rel="noopener noreferrer">
								<span class="code text-decoration-underline font-monospace" title="Course code"></span>
								<i class="bi-box-arrow-up-right"></i>
							</a>
						</div>
						<div>
							<span class="name" title="Course name"></span>
						</div>
						<div>
							<span class="fw-bold">Units:</span>
							<span class="units"></span>
						</div>
						<div>
							<span class="fw-bold">Repeat for credit:</span>
							<span class="repeat"></span>
						</div>
						<div>
							<span class="fw-bold">Included in GPA:</span>
							<span class="countgpa"></span>
						</div>
					</div>
				</div>
				<hr>
				<!--Grade-->
				<div class="row">
					<div class="col-3">
						<span class="h5">Grade</span>
					</div>
					<div class="col">
						<span class="grade-symbol fs-5 font-monospace" title="Grade symbol">-</span>
						<div>
							<span class="fw-bold">Description:</span>
							<span class="grade-desc"></span>
						</div>
						<div>
							<span class="fw-bold">GPV:</span>
							<span class="grade-gpv"></span>
						</div>
						<div>
							<span class="fw-bold">Passed:</span>
							<span class="grade-passed"></span>
						</div>
						<div class="mt-2">
							<span class="fw-bold">Weighted GPV:</span>
							<span class="grade-weighted" title="GPV x Units" data-bs-toggle="tooltip" data-bs-placement="right"></span>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer d-flex justify-content-around">
				<button class="btn btn-primary" data-bs-dismiss="modal" onclick="$('#modalEditUserCourse').modal('show')">
					<i class="bi-pencil-fill"></i>
					Edit
				</button>
			</div>
		</div>
	</div>
</div>

<!--Form modals-->

<!--Form add CourseCollection-->
<form id="formAddCollection" name="formAddCollection" method="POST">
	<div class="modal fade" id="modalAddCollection" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Add term</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body px-5">
					<div class="row g-2">
						<div class="col-md">
							<div class="form-floating">
								<select class="form-select" id="selectSeason" name="season" aria-label="Select season">
									{% for season in seasons %}
									<option value="{{season.value}}">{{season.name | capitalize}}</option>
									{% endfor %}
								</select>
								<label for="selectSeason">Season</label>
							</div>
						</div>
						<div class="col-md">
							<div class="form-floating">
								<select class="form-select" id="selectYear" name="year" aria-label="Select year">
									{% for year in years %}
									<option value="{{year}}">{{year}}</option>
									{% endfor %}
								</select>
								<label for="selectYear">Year</label>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer d-flex justify-content-around">
					<button type="submit" class="btn btn-primary" data-bs-dismiss="modal">
						Add
					</button>
				</div>
			</div>
		</div>
	</div>
</form>

<!--Form add UserCourse-->
<form id="formAddUserCourse" name="formAddUserCourse" method="POST">
	<div class="modal fade" id="modalAddCourse" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Add course to term</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body px-5">
					<!--Hidden fields-->
					<input type="number" name="collection_id" id="selectCollection" value="" readonly hidden>
					<input type="number" name="course_id" id="selectCourseId" value="" readonly hidden>

					<div class="d-flex flex-row justify-content-center">
						<!--Subject code-->
						<input type="text" class="selectSubject form-control form-control-lg fs-4 font-monospace text-end border-2 border-secondary bg-light text-body align-middle" id="selectCourseSubject" minlength="2" maxlength="4" value="" style="width: 4em;" autocomplete="off">

						<!--Separator-->
						<span class="h-100 p-2 m-0 fs-2 align-middle">–</span>

						<!--Course number-->
						<input type="text" class="selectNumber form-control form-control-lg fs-4 font-monospace text-begin border-2 border-secondary bg-light text-body align-middle px-3" id="selectCourseNumber" maxlength="3" value="" disabled style="width: 4em;" autocomplete="off">

						<!--Course exists status-->
						<div class="position-relative">
							<div class="status fs-4 h-100 position-absolute start-100 p-2 ps-3 d-flex flex-column justify-content-center" id="selectCourseStatus">
								<span class="error">
									<i class="bi-exclamation-circle-fill text-danger" data-bs-toggle="tooltip" data-bs-placement="right" aria-label="Course does not exist" title="Course does not exist"></i>
								</span>
								<span class="success">
									<i class="bi-check-circle-fill text-success" data-bs-toggle="tooltip" data-bs-placement="right" aria-label="Course exists" title="Course exists"></i>
								</span>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer d-flex justify-content-around">
					<button id="selectCourseSubmit" type="submit" class="submit btn btn-primary"  data-bs-dismiss="modal" disabled>
						Add
					</button>
				</div>
			</div>
		</div>
	</div>
</form>

<!--Form edit UserCourse-->
<form id="formEditUserCourse" name="formEditUserCourse" method="POST">
	<div class="modal fade" id="modalEditUserCourse" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Edit course</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body px-5">
					<!--Course-->
					<div class="row mb-2">
						<label for="selectCoursePlaceholder" class="col-3 col-form-label">Course</label>
						<div class="col-9">
							<input type="hidden" id="selectUserCourse" name="id" value="">
							<input type="text" id="selectCoursePlaceholder" class="form-control col-9" value="" disabled
								readonly>
						</div>
					</div>
					<!--Term-->
					<div class="row mb-2">
						<input type="hidden" id="selectCollectionOld" value="">
						<label class="col-3 col-form-label" for="selectCollection">Term</label>
						<div class="col-9">
							<select class="form-select" aria-label="Select term" name="collection_id"
								id="selectCollection">
								{% for collection in collections %}
								<option value="{{collection.id}}">
									{% if collection.transfer %}
									Transferred
									{% else %}
									{{collection.term.season.name | capitalize}} {{collection.term.year}}
									{% endif %}
								</option>
								{% endfor %}
							</select>
						</div>
					</div>
					<!--Grade-->
					<div class="row">
						<label class="col-3 col-form-label" for="selectGrade">Grade</label>
						<div class="col-4">
							<select class="form-select" aria-label="Select grade" name="grade" id="selectGrade">
								<option value="0">-</option>
								{% for id, grade in grades.items() %}
								<option value="{{id}}">
									{{grade["symbol"]}}
								</option>
								{% endfor %}
							</select>
						</div>
						<label class="col-3 col-form-label">Passed</label>
						<div class="col-2 py-2">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" name="passedCheck" id="selectPassed">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer d-flex justify-content-around">
					<button type="submit" method="DELETE" class="btn btn-danger"  data-bs-dismiss="modal">
						Remove
					</button>
					<button type="submit" method="PUT" class="btn btn-primary"  data-bs-dismiss="modal">
						Save changes
					</button>
				</div>
			</div>
		</div>
	</div>
</form>

{% endblock %}

{% block tailscripts %}
<script src="/static/scripts/planner.js"></script>
{% endblock %}